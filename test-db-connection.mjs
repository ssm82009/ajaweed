#!/usr/bin/env node\n\n/**\n * Database Connection Test Script\n * Run this script to test connection to Turso database\n * \n * Usage: node test-db-connection.mjs\n */\n\nimport { createClient } from '@libsql/client';\nimport dotenv from 'dotenv';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\n// Load .env from the root directory\ndotenv.config({ path: path.resolve(__dirname, '.env') });\n\nconsole.log('='.repeat(50));\nconsole.log('Database Connection Test');\nconsole.log('='.repeat(50));\n\n// Check environment variables\nconsole.log('\\n1. Checking environment variables...');\nconst tursoUrl = process.env.TURSO_URL;\nconst tursoToken = process.env.TURSO_AUTH_TOKEN;\n\nif (!tursoUrl) {\n  console.error('   ❌ TURSO_URL is not set in .env file');\n} else {\n  console.log('   ✓ TURSO_URL is set:', tursoUrl);\n}\n\nif (!tursoToken) {\n  console.error('   ❌ TURSO_AUTH_TOKEN is not set in .env file');\n} else {\n  console.log('   ✓ TURSO_AUTH_TOKEN is set (token length:', tursoToken.length, ')');\n}\n\nif (!tursoUrl || !tursoToken) {\n  console.log('\\n❌ Cannot proceed without environment variables');\n  console.log('Please update your .env file with the correct Turso credentials');\n  process.exit(1);\n}\n\n// Create client and test connection\nconsole.log('\\n2. Testing database connection...');\nconst db = createClient({\n  url: tursoUrl,\n  authToken: tursoToken,\n});\n\nasync function testConnection() {\n  try {\n    // Test basic connection\n    const startTime = Date.now();\n    const result = await db.execute('SELECT 1 as connection_test');\n    const duration = Date.now() - startTime;\n    \n    console.log('   ✓ Connection successful!');\n    console.log('   ✓ Response time:', duration + 'ms');\n    console.log('   ✓ Server response:', JSON.stringify(result));\n    \n    // Get database info\n    console.log('\\n3. Getting database information...');\n    const infoResult = await db.execute('SELECT sqlite_version() as version');\n    console.log('   ✓ SQLite version:', infoResult.rows[0].version);\n    \n    // List tables\n    console.log('\\n4. Listing database tables...');\n    const tablesResult = await db.execute(\n      \"SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name\"\n    );\n    console.log('   Tables found:', tablesResult.rows.length);\n    tablesResult.rows.forEach(row => {\n      console.log('   -', row.name);\n    });\n    \n    console.log('\\n' + '='.repeat(50));\n    console.log('✓ All tests passed! Database connection is working.');\n    console.log('='.repeat(50));\n    \n    process.exit(0);\n  } catch (error) {\n    console.error('\\n   ❌ Connection failed!');\n    console.error('   Error message:', error.message);\n    \n    // Provide helpful error messages\n    if (error.message.includes('auth') || error.message.includes('token') || error.message.includes('credential')) {\n      console.error('\\n   → Authentication failed. Please check your TURSO_AUTH_TOKEN');\n      console.error('   → The token may have expired. Generate a new one from the Turso dashboard.');\n    } else if (error.message.includes('DNS') || error.message.includes('getaddrinfo') || error.message.includes('EAI_AGAIN')) {\n      console.error('\\n   → DNS resolution failed. Please check your TURSO_URL');\n      console.error('   → Make sure the database URL is correct and accessible.');\n    } else if (error.message.includes('ECONNREFUSED')) {\n      console.error('\\n   → Connection refused. The server may be down or unreachable.');\n    } else if (error.message.includes('database') && error.message.includes('not exist')) {\n      console.error('\\n   → Database does not exist. Please check your TURSO_URL');\n    } else {\n      console.error('\\n   → Unknown error. Please check your network connection and credentials.');\n    }\n    \n    console.log('\\n' + '='.repeat(50));\n    console.log('❌ Database connection failed');\n    console.log('='.repeat(50));\n    \n    process.exit(1);\n  }\n}\n\ntestConnection();\n